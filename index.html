<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="icon" type="image/png" href="data:image/png;base64,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">
    <meta charset="UTF-8">
    <title>–≠–∫–æ–Ω–æ–º–∏–∫–∞ Mystic 1.20.1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root {
            --bg-dark: #0e0f11;
            --bg-sidebar: #18191c;
            --bg-main: #232428;
            --bg-card: #2f3136;
            --blurple: #5865f2;
            --green: #2ecc71;
            --green-glow: rgba(46, 204, 113, 0.3);
            --text-full: #ffffff;
            --text-muted: #a3a6aa;
            --red: #e74c3c;
            --yellow: #faa61a;
            --border: rgba(255,255,255,0.05);
        }

        /* –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤ –∏ –±–∞–∑–æ–≤—ã—Ö —Å—Ç–∏–ª–µ–π */
        * { box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: var(--bg-dark); color: var(--text-full); overflow: hidden; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #3e4046; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--green); }

        /* –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–π –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-item { animation: fadeIn 0.3s ease-out forwards; }

        .app-container { display: flex; width: 100vw; height: 100vh; }

        .sidebar { width: 350px; background: var(--bg-sidebar); border-right: 1px solid #000; display: none; flex-direction: column; }
        body.admin-mode .sidebar { display: flex; }
        .sidebar-header { padding: 20px; background: rgba(0,0,0,0.2); border-bottom: 1px solid var(--border); }
        .warehouse-scroll { flex: 1; overflow-y: scroll; padding: 15px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; background: #121315; }
        
        .item-node { 
            background: var(--bg-card); 
            border-radius: 8px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            border: 1px solid transparent; 
            transition: 0.2s; 
            padding: 8px 4px;
            height: 80px; 
            text-decoration: none;
            overflow: hidden;
        }

        .item-node:hover { 
            transform: scale(1.05); 
            border-color: var(--green); 
            box-shadow: 0 0 15px var(--green-glow); 
            z-index: 10; 
        }

        .item-node img { 
            width: 32px; 
            height: 32px; 
            flex-shrink: 0; 
            image-rendering: pixelated; 
            margin-bottom: 6px;
            object-fit: contain;
        }

        .item-node span {
            font-size: 10px;
            color: var(--text-muted);
            width: 100%;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; 
            padding: 0 2px;
        }

        .main { flex: 1; display: flex; flex-direction: column; background: var(--bg-main); }
       /* –ë–∞–∑–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav { 
            height: 75px; 
            background: var(--bg-sidebar); 
            padding: 0 25px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            border-bottom: 1px solid var(--border); 
            position: relative;
        }

        .nav-left { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            flex-shrink: 0; 
            z-index: 5;
        }

        /* –¶–µ–Ω—Ç—Ä–æ–≤–∫–∞ –ø–æ–∏—Å–∫–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è */
        .nav-center { 
            position: absolute; 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 10;
            display: flex;
            justify-content: center;
        }

        .nav-right { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            flex-shrink: 0;
            z-index: 5;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –ø–æ–ª–µ–π */
        input, select { 
            background: var(--bg-dark); 
            color: #fff; 
            border: 1px solid var(--border); 
            padding: 0 10px; 
            border-radius: 8px; 
            outline: none; 
            height: 36px;
            font-size: 13px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* –ñ–µ—Å—Ç–∫–∏–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ –º–æ–¥–æ–≤/–∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        select {
            width: 140px !important;
            max-width: 140px !important;
            min-width: 140px !important;
            cursor: pointer;
            appearance: auto !important;
            -webkit-appearance: menulist !important;
        }

        /* –ü–æ–∏—Å–∫: —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ */
        input#search {
            width: 160px;
            min-width: 160px;
            cursor: text;
            text-align: center;
            background: var(--bg-dark) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>') no-repeat 12px center;
            padding-left: 35px;
        }

        input#search:focus { 
            width: 350px; 
            text-align: left;
            border-color: var(--green);
            box-shadow: 0 0 10px var(--green-glow);
        }

        /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø (–ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞) */
   /* --- –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø --- */
@media (max-width: 950px) {
    .nav {
        height: auto;
        padding: 20px 15px; /* –£–≤–µ–ª–∏—á–∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã –≤—Å–µ–π —à–∞–ø–∫–∏ */
        flex-direction: column;
        gap: 15px; /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ä—è–¥–∞–º–∏ */
        justify-content: center;
    }

    /* –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ (Mystic 1.20.1) */
    .nav-left span:first-child {
        display: block;
        width: 100%;
        text-align: center;
        margin-bottom: 10px; /* –û—Ç—Ç–∞–ª–∫–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –º–æ–¥–æ–≤ */
        font-size: 18px;
    }

    .nav-left {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ–ª–µ–∫—Ç–∞–º –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è, –µ—Å–ª–∏ —ç–∫—Ä–∞–Ω –æ—á–µ–Ω—å —É–∑–∫–∏–π */
        gap: 10px;
    }

    .nav-center {
        position: static;
        transform: none;
        width: 100%;
        order: 3; /* –ü–æ–∏—Å–∫ —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –≤ —Å–∞–º–æ–º –Ω–∏–∑—É —à–∞–ø–∫–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ */
    }

    .nav-right {
        width: 100%;
        justify-content: center;
        margin: 0;
        order: 4; /* –ö–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∞ –ø–æ–¥ –ø–æ–∏—Å–∫–æ–º */
    }

    input#search {
        width: 100% !important;
        margin: 5px 0;
    }

    select {
        /* –ù–∞ –º–æ–±–∏–ª–∫–∞—Ö –¥–µ–ª–∞–µ–º —Å–µ–ª–µ–∫—Ç—ã —á—É—Ç—å —à–∏—Ä–µ, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ –æ–±—Ä–µ–∑–∞–ª—Å—è —Å–∏–ª—å–Ω–æ */
        width: calc(50% - 10px) !important;
        min-width: 140px !important; 
    }
}

.admin-view { 
    display: none; 
    align-items: center; 
    gap: 10px; 
}

body.admin-mode .admin-view { display: flex !important; }

/* –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º —Ç–µ–∫—Å—Ç–∞ */
.card-name {
    text-align: center; 
    font-weight: 700; 
    font-size: 14px; 
    margin-bottom: 4px; 
    color: #fff; 
    display: block; 
    word-break: break-word; 
    line-height: 1.2; 
    min-height: 34px;
}

        input#search { 
            width: 160px; 
            cursor: pointer; 
            text-align: center;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s, border-color 0.3s;
            background: var(--bg-dark) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>') no-repeat 12px center;
            padding-left: 35px;
        }
        input#search:focus { width: 450px; text-align: left; }

        /* –ù–∞–π–¥–∏ —ç—Ç–æ –º–µ—Å—Ç–æ –≤ CSS –∏ –∑–∞–º–µ–Ω–∏/–¥–æ–±–∞–≤—å */
/* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ */
.nav-left {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 0 1 auto; /* –ù–µ –¥–∞–µ—Ç –±–ª–æ–∫—É –≤—ã—Ç–µ—Å–Ω—è—Ç—å –ø–æ–∏—Å–∫ */
}

input, select { 
    background: var(--bg-dark); 
    color: #fff; 
    border: 1px solid var(--border); 
    padding: 0 10px; 
    border-radius: 8px; 
    outline: none; 
    height: 36px;
    font-size: 13px;
    
    /* –ñ–ï–°–¢–ö–ò–ï –ì–†–ê–ù–ò–¶–´ */
    width: 140px; 
    max-width: 140px; 
    min-width: 140px;
    
    /* –ß—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ —Å–∞–º–æ–π –∫–Ω–æ–ø–∫–∏ –Ω–µ –≤—ã–ª–µ–∑–∞–ª */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    
    cursor: pointer;
}

/* –§–∏–∫—Å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞–ª–æ —Å–µ—Ç–∫—É */
@media (max-width: 768px) {
    input, select {
        width: 100%;
        max-width: none;
        min-width: 0;
    }
}

/* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ, –∫–∞–∫ –±—ã–ª–∞ —Ä–∞–Ω—å—à–µ */
input:focus, select:focus {
    border-color: var(--green);
    box-shadow: 0 0 10px var(--green-glow);
}

/* –£–±–∏—Ä–∞–µ–º –Ω–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–æ–Ω-—Å—Ç—Ä–µ–ª–æ—á–∫—É, –ø—É—Å—Ç—å –±—É–¥–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–∞—è */
select {
    appearance: auto !important; 
    -webkit-appearance: menulist !important;
}

/* –ü–æ–∏—Å–∫ —Ç–µ–ø–µ—Ä—å –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ */
input#search {
    width: 160px; /* –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
    min-width: 160px; /* –ß—Ç–æ–±—ã –Ω–µ —Å—Ö–ª–æ–ø–Ω—É–ª—Å—è —Å–æ–≤—Å–µ–º */
    max-width: 450px; /* –ü—Ä–µ–¥–µ–ª —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è */
    cursor: text;
}

/* –≠—Ñ—Ñ–µ–∫—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –ø–æ–∏—Å–∫ */
input#search:focus { 
    width: 350px; 
    border-color: var(--green);
    box-shadow: 0 0 10px var(--green-glow);
}

@media (max-width: 600px) {
    input#search:focus {
        width: 100%; /* –ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞ */
    }
}


        }
        input:focus, select:focus { border-color: var(--green); box-shadow: 0 0 10px var(--green-glow); }

        .market-scroll { flex: 1; overflow-y: scroll; padding: 25px; }
        .market-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .card { 
            background: var(--bg-card); border-radius: 15px; padding: 18px; position: relative; 
            border: 1px solid var(--border); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer; overflow: hidden;
        }
        .card:hover { 
            transform: translateY(-5px) scale(1.03); 
            border-color: var(--green); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 20px var(--green-glow);
            background: #36393f;
            z-index: 5;
        }
        .card img { width: 50px; height: 50px; display: block; margin: 0 auto 12px; image-rendering: pixelated; transition: 0.3s; }
        .card:hover img { transform: scale(1.2); }

        .price-badge { 
            text-align: center; margin-top: 12px; background: var(--bg-dark); padding: 8px; 
            border-radius: 8px; font-size: 14px; font-weight: bold; color: var(--green); 
            border: 1px solid transparent; transition: 0.3s; 
        }
        .card:hover .price-badge { border-color: var(--green); box-shadow: 0 0 10px var(--green-glow); color: #fff; background: rgba(46, 204, 113, 0.2); }

        /* –ö–æ—Ä–∑–∏–Ω–∞ –∏ –º–æ–¥–∞–ª–∫–∏ */
        #cart-trigger {
            position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px; background: var(--green);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 10px 30px var(--green-glow); z-index: 999; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); opacity: 0; visibility: hidden; transform: translateY(100px) scale(0.5);
        }
        #cart-trigger.visible { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }
        #cart-count { position: absolute; top: -5px; right: -5px; background: var(--red); color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(6px); display: none; align-items: center; justify-content: center; z-index: 10001; }
        .modal-box { background: var(--bg-sidebar); padding: 30px; border-radius: 20px; width: 420px; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 15px; }

        .admin-view { display: none !important; }
        body.admin-mode .admin-view { display: flex !important; }

        @keyframes pulse-green {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 15px 5px rgba(46, 204, 113, 0.4); border-color: var(--green); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        .added-flash { animation: pulse-green 0.4s ease-out; }

        button { padding: 8px 16px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; background: var(--green); color: #000; transition: 0.2s; }
        button:hover { filter: brightness(1.1); transform: scale(1.02); }
        button.danger { background: var(--red); color: #fff; }
        button.yellow { background: var(--yellow); color: #000; }
        button.blurple { background: var(--blurple); color: #fff; }

        .cart-item { display: flex; align-items: center; gap: 12px; background: var(--bg-dark); padding: 10px; border-radius: 10px; margin-bottom: 8px; }
        .cart-qty-input { width: 45px !important; text-align: center; background: var(--bg-main) !important; border: 1px solid var(--green) !important; color: #fff; }
    </style>
</head>
<body class="player-mode">

<div id="edit-modal" class="modal">
    <div class="modal-box">
        <h2 style="margin:0 0 10px 0; color:var(--green)">–†–µ–¥–∞–∫—Ç–æ—Ä</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div><label style="font-size:10px">–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="ed-name"></div>
            <div><label style="font-size:10px">–¶–µ–Ω–∞</label><input type="number" id="ed-price"></div>
        </div>
        <div><label style="font-size:10px">–ò–∫–æ–Ω–∫–∞</label><input type="text" id="ed-img"></div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div><label style="font-size:10px">–ú–æ–¥</label><select id="ed-mod"></select></div>
            <div><label style="font-size:10px">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label><select id="ed-cat"></select></div>
        </div>
        <button onclick="confirmEdit()">–°–û–•–†–ê–ù–ò–¢–¨</button>
        <button onclick="closeModals()" style="background:transparent; color:var(--text-muted)">–ó–ê–ö–†–´–¢–¨</button>
    </div>
</div>

<div id="cart-modal" class="modal">
    <div class="modal-box">
        <h2 style="color: var(--green); margin: 0 0 15px 0;">üõí –ó–ê–ö–ê–ó</h2>
        <div id="cart-items-list" style="max-height: 400px; overflow-y: auto;"></div>
        <div style="border-top: 2px solid var(--border); padding-top: 15px;">
            <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-bottom: 15px;">
                <span>–ò–¢–û–ì–û:</span><span id="cart-total" style="color: var(--green);">0 $</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="danger" onclick="clearCart()" style="flex: 1;">–û–ß–ò–°–¢–ò–¢–¨</button>
                <button onclick="closeModals()" style="flex: 1; background: #4f545c; color: white;">–ó–ê–ö–†–´–¢–¨</button>
            </div>
        </div>
    </div>
</div>

<div class="app-container">
    <div class="sidebar">
        <div class="sidebar-header">
            <div style="display: flex; gap: 5px;">
                <label style="flex: 1; background: #36393f; color: white; padding: 10px; border-radius: 8px; text-align:center; cursor:pointer; font-size:13px;">
                    JAR <span id="loadedCount"></span>
                    <input type="file" id="jarLoader" accept=".jar" hidden multiple>
                </label>
                <button onclick="createCustomItem()" class="blurple">+</button>
            </div>
        </div>
        <div id="warehouse" class="warehouse-scroll"></div>
    </div>

    <div class="main">
        <div class="nav">
            <div class="nav-left">
                <span style="font-weight: bold; color: var(--green);">Mystic 1.20.1</span>
                <select id="filterMod" onchange="render()"><option value="all">–í—Å–µ –º–æ–¥—ã</option></select>
                <select id="filterCat" onchange="render()"><option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option></select>
                <select id="sortPrice" onchange="render()">
                    <option value="none">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</option>
                    <option value="low">–î–µ—à–µ–≤–ª–µ</option>
                    <option value="high">–î–æ—Ä–æ–∂–µ</option>
                </select>
            </div>
            <div class="nav-center"><input type="text" id="search" placeholder="–ü–æ–∏—Å–∫..." oninput="render()"></div>
            <div class="nav-right">
                <button onclick="toggleAdmin()" id="admBtn" style="display: none;">–ê–î–ú–ò–ù</button>
                <div class="admin-view" style="gap:10px;">
    <div style="display:flex; gap:2px; align-items:center; border-right: 1px solid var(--border); padding-right:10px;">
        <button onclick="addMod()" class="blurple" style="padding:4px 8px;">+ –ú–æ–¥</button>
        <button onclick="delMod()" class="danger" style="padding:4px 8px;">√ó</button>
    </div>
    <div style="display:flex; gap:2px; align-items:center; border-right: 1px solid var(--border); padding-right:10px;">
        <button onclick="addCat()" class="blurple" style="padding:4px 8px;">+ –ö–∞—Ç.</button>
        <button onclick="delCat()" class="danger" style="padding:4px 8px;">√ó</button>
    </div>
    <button onclick="saveGlobal()" class="blurple">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î</button>
     <button onclick="downloadBackup()" class="yellow">üì• –ë—ç–∫–∞–ø –≤ —Ñ–∞–π–ª</button>
</div>
            </div>
        </div>
        <div class="market-scroll"><div id="grid" class="market-grid"></div></div>
    </div>
</div>

<div id="cart-trigger" onclick="openCart()"><span>üõí</span><div id="cart-count">0</div></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyBJheg1xrRBz6wHXzpV4dxGDFtgPm3gjJQ",
    authDomain: "ecomyst-d5c0e.firebaseapp.com",
    databaseURL: "https://ecomyst-d5c0e-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "ecomyst-d5c0e",
    storageBucket: "ecomyst-d5c0e.firebasestorage.app",
    appId: "1:745331166808:web:1e004fd05c0d9a0301442d"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let db = { servers: [{name: "Mystic 1.20.1", items: []}], mods: [], cats: [] };
let cart = [];
let curSrvIdx = 0;
let isAdmin = false;
let editingIdx = null;

function init() {
    database.ref('shopData').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            db = data;
            if(!db.servers) db.servers = [{name: "Mystic 1.20.1", items: []}];
            updateSelects(); 
            render();
        }
    });

    document.addEventListener('keydown', (e) => {
        if (["INPUT", "TEXTAREA", "SELECT"].includes(document.activeElement.tagName)) return;
        if (e.key.toLowerCase() === 'l' || e.key.toLowerCase() === '–¥') toggleAdmin();
    });
}

function toggleAdmin() {
    if (!isAdmin) {
        const pass = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:");
        if (!pass) return; // –ï—Å–ª–∏ –Ω–∞–∂–∞–ª "–û—Ç–º–µ–Ω–∞"

        database.ref('shopData/adminPass').once('value').then((snap) => {
            if (pass === String(snap.val())) {
                isAdmin = true;
                document.body.classList.add('admin-mode');
                document.getElementById('admBtn').innerText = '–í–´–ô–¢–ò';
                render();
            } else {
                alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω.");
            }
        }).catch(err => {
            console.error(err);
            alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö");
        });
    } else {
        isAdmin = false;
        document.body.classList.remove('admin-mode');
        document.getElementById('admBtn').innerText = '–ê–î–ú–ò–ù';
        render();
    }
}

function render() {
    if (!db || !db.servers[curSrvIdx]) return;
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    
    const search = document.getElementById('search').value.toLowerCase();
    const selMod = document.getElementById('filterMod').value;
    const selCat = document.getElementById('filterCat').value;
    const sort = document.getElementById('sortPrice').value;
    
    let filtered = [...(db.servers[curSrvIdx].items || [])].filter(it => {
        return it.name.toLowerCase().includes(search) && 
               (selMod === 'all' || it.mod === selMod) && 
               (selCat === 'all' || it.cat === selCat);
    });

    if(sort === 'low') filtered.sort((a,b) => a.price - b.price);
    if(sort === 'high') filtered.sort((a,b) => b.price - a.price);

    filtered.forEach((it) => {
        const realIdx = db.servers[curSrvIdx].items.indexOf(it);
        const card = document.createElement('div');
        card.className = 'card animate-item';
        card.innerHTML = `
            <div class="admin-view" style="position:absolute; top:10px; right:10px; gap:4px; z-index:10;">
                <button class="yellow" style="padding:4px 6px" onclick="event.stopPropagation(); openEdit(${realIdx})">‚úèÔ∏è</button>
                <button class="danger" style="padding:4px 6px" onclick="event.stopPropagation(); del(${realIdx})">√ó</button>
            </div>
            <img src="${it.img}" onerror="this.src='https://i.imgur.com/hYfN4D7.png'">
            
<div style="text-align:center; font-weight:700; font-size:14px; margin-bottom: 4px; color: #fff; display: block; word-break: break-word; line-height: 1.2; min-height: 34px;">
    ${it.name}
</div>
            <div style="text-align:center; font-size:11px; color:var(--text-muted); margin-bottom: 12px;">
                ${it.mod || 'Vanilla'} ‚Ä¢ ${it.cat || '–ü—Ä–µ–¥–º–µ—Ç—ã'}
            </div>
            <div class="price-badge">${it.price} $</div>
        `;
        card.onclick = isAdmin ? null : (e) => addToCart(it, e);
        grid.appendChild(card);
    });
}

function addToCart(item, event) {
    let existing = cart.find(c => c.name === item.name);
    if(existing) existing.count++; else cart.push({...item, count: 1});
    updateCartUI();
    
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ "–ª–µ—Ç—É—á–µ–π" –∞–Ω–∏–º–∞—Ü–∏–∏
    if (event) {
        const trigger = document.getElementById('cart-trigger');
        const rect = trigger.getBoundingClientRect();
        const flyer = document.createElement('img');
        flyer.src = item.img;
        flyer.style.cssText = `width:40px;height:40px;position:fixed;z-index:10000;transition:all 0.6s ease;left:${event.clientX-20}px;top:${event.clientY-20}px;image-rendering:pixelated;`;
        document.body.appendChild(flyer);
        setTimeout(() => {
            flyer.style.left = (rect.left + 10) + 'px';
            flyer.style.top = (rect.top + 10) + 'px';
            flyer.style.transform = 'scale(0.2)';
            flyer.style.opacity = '0';
        }, 10);
        setTimeout(() => flyer.remove(), 600);
    }
}

function updateCartUI() {
    const count = cart.reduce((s, i) => s + i.count, 0);
    const trigger = document.getElementById('cart-trigger');
    document.getElementById('cart-count').innerText = count;
    if (count > 0 && !isAdmin) trigger.classList.add('visible'); else trigger.classList.remove('visible');
}

function openCart() {
    const list = document.getElementById('cart-items-list');
    list.innerHTML = '';
    let total = 0;
    
    cart.forEach((it, idx) => {
        total += it.price * it.count;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.style.cssText = "display: flex; align-items: center; gap: 10px; background: var(--bg-dark); padding: 10px; border-radius: 10px; margin-bottom: 8px;";
        
        div.innerHTML = `
            <img src="${it.img}" style="width:32px; height:32px; image-rendering:pixelated; flex-shrink: 0;">
            
            <div style="flex: 1; min-width: 0;">
                <div style="font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 14px;" title="${it.name}">
                    ${it.name}
                </div>
                <small style="color: var(--green); font-weight: bold;">${it.price * it.count} $</small>
            </div>

            <div style="display: flex; align-items: center; gap: 5px; background: var(--bg-main); padding: 4px; border-radius: 6px; border: 1px solid var(--border);">
                <button onclick="updateQtyManual(${idx}, ${it.count - 1})" style="padding: 2px 8px; background: transparent; color: var(--text-muted); font-size: 16px;">-</button>
                <span style="min-width: 20px; text-align: center; font-weight: bold; font-size: 13px;">${it.count}</span>
                <button onclick="updateQtyManual(${idx}, ${it.count + 1})" style="padding: 2px 8px; background: transparent; color: var(--green); font-size: 16px;">+</button>
            </div>

            <button class="danger" onclick="deleteFromCart(${idx})" style="padding: 6px 10px; border-radius: 6px; flex-shrink: 0;">√ó</button>
        `;
        list.appendChild(div);
    });
    
    document.getElementById('cart-total').innerText = total + ' $';
    document.getElementById('cart-modal').style.display = 'flex';
}

// –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, —á—Ç–æ–±—ã –æ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏:
function updateQtyManual(idx, val) {
    const newVal = parseInt(val);
    if (newVal <= 0) {
        deleteFromCart(idx);
    } else {
        cart[idx].count = newVal;
        openCart();
        updateCartUI();
    }
}

function updateQtyManual(idx, val) {
    cart[idx].count = parseInt(val) || 1;
    openCart(); updateCartUI();
}

function deleteFromCart(idx) {
    cart.splice(idx, 1);
    if(cart.length === 0) closeModals(); else openCart();
    updateCartUI();
}

function clearCart() { cart = []; updateCartUI(); closeModals(); }
function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

function updateSelects() {
    const fm = document.getElementById('filterMod'), fc = document.getElementById('filterCat');
    const em = document.getElementById('ed-mod'), ec = document.getElementById('ed-cat');
    
    if (!fm || !fc || !em || !ec || !db) return;

    const currentMod = fm.value;
    const currentCat = fc.value;

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ –¥–ª–∏–Ω–Ω—ã—Ö –∏–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–æ–ª—å—à–µ 18 —Å–∏–º–≤–æ–ª–æ–≤)
    const truncate = (str, len = 18) => str.length > len ? str.substring(0, len) + '...' : str;

    const mods = db.mods || [];
    const cats = db.cats || [];

    // –í–ù–ò–ú–ê–ù–ò–ï: –≤ value –∫–ª–∞–¥–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç ${m}, –∞ –≤ —Ç–µ–∫—Å—Ç –æ–ø—Ü–∏–∏ ‚Äî –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π truncate(m)
    const modOpts = mods.map(m => `<option value="${m}" title="${m}">${truncate(m)}</option>`).join('');
    const catOpts = cats.map(c => `<option value="${c}" title="${c}">${truncate(c)}</option>`).join('');

    fm.innerHTML = '<option value="all">–í—Å–µ –º–æ–¥—ã</option>' + modOpts;
    fc.innerHTML = '<option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>' + catOpts;
    em.innerHTML = modOpts; 
    ec.innerHTML = catOpts;

    if ([...fm.options].some(o => o.value === currentMod)) fm.value = currentMod;
    if ([...fc.options].some(o => o.value === currentCat)) fc.value = currentCat;
}

function openEdit(i) {
    editingIdx = i; const it = db.servers[curSrvIdx].items[i];
    document.getElementById('ed-name').value = it.name;
    document.getElementById('ed-price').value = it.price;
    document.getElementById('ed-img').value = it.img;
    document.getElementById('ed-mod').value = it.mod;
    document.getElementById('ed-cat').value = it.cat;
    document.getElementById('edit-modal').style.display = 'flex';
}

function confirmEdit() {
    const it = db.servers[curSrvIdx].items[editingIdx];
    it.name = document.getElementById('ed-name').value;
    it.price = parseFloat(document.getElementById('ed-price').value) || 0;
    it.img = document.getElementById('ed-img').value;
    it.mod = document.getElementById('ed-mod').value;
    it.cat = document.getElementById('ed-cat').value;
    closeModals(); render();
}

function del(i) { if(confirm('–£–¥–∞–ª–∏—Ç—å?')) { db.servers[curSrvIdx].items.splice(i,1); render(); } }

function saveGlobal() {
    // –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–∞—Ä–æ–ª—å –ü–†–Ø–ú–û –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    const pass = prompt("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏:");
    if (!pass) return;

    // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ—ë –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–ª–µ lastPass
    // –≠—Ç–æ –ø–æ–ª–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç —Å–µ—Ä–≤–µ—Ä Firebase –∏ —Å—Ä–∞–≤–Ω–∏—Ç —Å —Ç–µ–º, —á—Ç–æ –≤ –±–∞–∑–µ
    const dataToSend = {
        ...db,
        lastPass: pass
    };

    database.ref('shopData').update(dataToSend)
        .then(() => {
            alert("‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –æ–±–ª–∞–∫–æ–º!");
        })
        .catch((err) => {
            console.error(err);
            alert("‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞! –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ –≤–∑–ª–æ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω.");
        });
}

function createCustomItem() {
    db.servers[curSrvIdx].items.push({ name: "–ù–æ–≤—ã–π", price: 0, img: "", mod: db.mods[0], cat: db.cats[0] });
    render(); openEdit(db.servers[curSrvIdx].items.length - 1);
}

document.getElementById('jarLoader').onchange = async (e) => {
    const files = e.target.files;
    const w = document.getElementById('warehouse');
    w.innerHTML = '';
    let total = 0;
    for (let file of files) {
        const zip = await JSZip.loadAsync(file);
        const mName = file.name.replace('.jar', '');
        if(!db.mods.includes(mName)) db.mods.push(mName);
        const tex = Object.keys(zip.files).filter(p => p.endsWith('.png') && p.includes('textures/'));
        for(let p of tex) {
            const b64 = await zip.file(p).async("base64");
            const img = `data:image/png;base64,${b64}`;
            const name = p.split('/').pop().replace('.png', '');
            const div = document.createElement('div');
            div.className = 'item-node';
            div.innerHTML = `<img src="${img}"><span>${name}</span>`;
           // –í–Ω—É—Ç—Ä–∏ jarLoader.onchange, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ div.onclick:
div.onclick = function() {
    this.classList.add('added-flash');
    setTimeout(() => this.classList.remove('added-flash'), 400);

    const sMod = document.getElementById('filterMod').value;
    const sCat = document.getElementById('filterCat').value;

    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ "–í—Å–µ...", –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–≤–∏–º Vanilla/–†–∞–∑–Ω–æ–µ
    const finalMod = (sMod === 'all') ? "Vanilla" : sMod;
    const finalCat = (sCat === 'all') ? "–†–∞–∑–Ω–æ–µ" : sCat;

    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –±–∞–∑—É, –µ—Å–ª–∏ —Ç–∞–∫–∏—Ö –∏–º–µ–Ω –µ—â–µ –Ω–µ—Ç
    if (!db.mods.includes(finalMod)) db.mods.push(finalMod);
    if (!db.cats.includes(finalCat)) db.cats.push(finalCat);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç—ã (—Ç–µ–ø–µ—Ä—å –æ–Ω–∏ –Ω–µ —Å–±—Ä–æ—Å—è—Ç—Å—è)
    updateSelects();

    db.servers[curSrvIdx].items.push({ 
        name: name, 
        img: img, 
        mod: finalMod, 
        cat: finalCat, 
        price: 0 
    });
    
    render();
};
            w.appendChild(div); total++;
        }
    }
    updateSelects();
    document.getElementById('loadedCount').innerText = `(${total})`;
};

init();

function addMod() {
    const name = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–¥–∞:");
    if (name && !db.mods.includes(name)) {
        db.mods.push(name);
        updateSelects();
        alert("–ú–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω! –ù–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞–∂–∞—Ç—å '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'.");
    }
}

function delMod() {
    const val = document.getElementById('filterMod').value;
    if (val === 'all') return alert("–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è");
    if (confirm(`–£–¥–∞–ª–∏—Ç—å –º–æ–¥ "${val}" –∏–∑ —Å–ø–∏—Å–∫–∞?`)) {
        db.mods = db.mods.filter(m => m !== val);
        updateSelects();
    }
}

function addCat() {
    const name = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:");
    if (name && !db.cats.includes(name)) {
        db.cats.push(name);
        updateSelects();
        alert("–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!");
    }
}

function delCat() {
    const val = document.getElementById('filterCat').value;
    if (val === 'all') return alert("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è");
    if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${val}"?`)) {
        db.cats = db.cats.filter(c => c !== val);
        updateSelects();
    }
}

    function downloadBackup() {
    // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –±–∞–∑—ã –±–µ–∑ –ø–∞—Ä–æ–ª–µ–π –∏ –ª–∏—à–Ω–∏—Ö –ø–æ–ª–µ–π
    const backupData = JSON.stringify(db, null, 4);
    
    // –°–æ–∑–¥–∞–µ–º "–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π" —Ñ–∞–π–ª
    const blob = new Blob([backupData], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    const a = document.createElement('a');
    a.href = url;
    a.download = `mystic_backup_${new Date().toLocaleDateString()}.json`;
    
    // –°–∏–º—É–ª–∏—Ä—É–µ–º –∫–ª–∏–∫ –∏ —É–¥–∞–ª—è–µ–º —Å—Å—ã–ª–∫—É
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert("–§–∞–π–ª –±—ç–∫–∞–ø–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –∏ —Å–∫–∞—á–∞–Ω!");
}
    
</script>
</body>
</html>




